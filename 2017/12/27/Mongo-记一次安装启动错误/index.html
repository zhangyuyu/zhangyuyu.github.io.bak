<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Mongo," />





  <link rel="alternate" href="/atom.xml" title="若见喻笺" type="application/atom+xml" />






<meta name="description" content="一、背景　　笔者最近换了电脑，从MacBook Pro 13”换成了MacBook Pro 15”，相关的工具软件全部得重新装。再重新装Mongo的时候遇到了一些问题，特此记录。 二、安装异常1. 错误描述">
<meta name="keywords" content="Mongo">
<meta property="og:type" content="article">
<meta property="og:title" content="Mongo-记一次安装启动异常">
<meta property="og:url" content="http://yoursite.com/2017/12/27/Mongo-记一次安装启动错误/index.html">
<meta property="og:site_name" content="若见喻笺">
<meta property="og:description" content="一、背景　　笔者最近换了电脑，从MacBook Pro 13”换成了MacBook Pro 15”，相关的工具软件全部得重新装。再重新装Mongo的时候遇到了一些问题，特此记录。 二、安装异常1. 错误描述">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-06-24T15:36:15.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mongo-记一次安装启动异常">
<meta name="twitter:description" content="一、背景　　笔者最近换了电脑，从MacBook Pro 13”换成了MacBook Pro 15”，相关的工具软件全部得重新装。再重新装Mongo的时候遇到了一些问题，特此记录。 二、安装异常1. 错误描述">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/12/27/Mongo-记一次安装启动错误/"/>





  <title>Mongo-记一次安装启动异常 | 若见喻笺</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">若见喻笺</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/27/Mongo-记一次安装启动错误/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhang Yu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="若见喻笺">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Mongo-记一次安装启动异常</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-27T11:35:21+01:00">
                2017-12-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Programmming/" itemprop="url" rel="index">
                    <span itemprop="name">Programmming</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="一、背景"><a href="#一、背景" class="headerlink" title="一、背景"></a>一、背景</h2><p>　　笔者最近换了电脑，从MacBook Pro 13”换成了MacBook Pro 15”，相关的工具软件全部得重新装。<br>再重新装Mongo的时候遇到了一些问题，特此记录。</p>
<h2 id="二、安装异常"><a href="#二、安装异常" class="headerlink" title="二、安装异常"></a>二、安装异常</h2><h3 id="1-错误描述"><a href="#1-错误描述" class="headerlink" title="1. 错误描述"></a>1. 错误描述</h3><a id="more"></a>
<p>　　用<code>brew install mongodb</code>安装了最新的mongodb(3.6)之后，启动本地的java spring boot应用，报错如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">com.mongodb.MongoCommandException</span>: Command failed with error 9: 'The 'cursor' option is required, except for aggregate with the explain argument' on server localhost:27017. The full response is &#123; "ok" : 0.0, "errmsg" : "The 'cursor' option is required, except for aggregate with the explain argument", "code" : 9, "codeName" : "FailedToParse" &#125;</span><br><span class="line"></span><br><span class="line">        at com.mongodb.CommandResult.getException(CommandResult.java:80)</span><br><span class="line"></span><br><span class="line">        at com.mongodb.CommandResult.throwOnError(CommandResult.java:94)</span><br><span class="line"></span><br><span class="line">        at org.springframework.data.mongodb.core.MongoTemplate.handleCommandError(MongoTemplate.java:2097)</span><br><span class="line"></span><br><span class="line">        ... 119 common frames omitted</span><br></pre></td></tr></table></figure>
<h3 id="2-错误原因"><a href="#2-错误原因" class="headerlink" title="2. 错误原因"></a>2. 错误原因</h3><p>　　MongoDB 3.6的Document，对于aggregation cursor的描述如下:</p>
<blockquote>
<pre><code>Specify a document that contains options that control the creation of the cursor object.
</code></pre></blockquote>
<pre><code>Changed in version 3.6: MongoDB 3.6 removes the use of aggregate command without the cursor
option unless the command includes the explain option. Unless you include the explain option,
you must specify the cursor option.
</code></pre><blockquote>
</blockquote>
<pre><code>To indicate a cursor with the default batch size, specify cursor: {}.
</code></pre><blockquote>
</blockquote>
<pre><code>To indicate a cursor with a non-default batch size, use cursor: { batchSize: &lt;num&gt; }.
</code></pre><p>　　MongoDB在3.6里面改变了aggregation指令的工作方式，现在aggregation需要cursor了。</p>
<h3 id="3-解决办法"><a href="#3-解决办法" class="headerlink" title="3. 解决办法"></a>3. 解决办法</h3><p>　　对本地的mongodb降级。</p>
<h4 id="1）先用brew-search查看支持的mongo版本"><a href="#1）先用brew-search查看支持的mongo版本" class="headerlink" title="1）先用brew search查看支持的mongo版本"></a>1）先用brew search查看支持的mongo版本</h4><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ brew search mongo</span><br><span class="line">=<span class="ruby">=&gt; Searching local taps...</span></span><br><span class="line"><span class="ruby">mongodb@3.<span class="number">4</span> ✔                          mongo-cxx-driver                       mongodb                                mongodb@3.<span class="number">2</span>                            percona-server-mongodb</span></span><br><span class="line"><span class="ruby">mongo-c-driver                         mongo-orchestration                    mongodb@3.<span class="number">0</span>                            mongoose</span></span><br><span class="line"><span class="ruby">==&gt; Searching taps on GitHub...</span></span><br><span class="line"><span class="ruby">caskroom/cask/mongo-management-studio  homebrew/php/php53-mongo               homebrew/php/php54-mongo               homebrew/php/php55-mongo               homebrew/php/php56-mongo</span></span><br><span class="line"><span class="ruby">==&gt; Searching blacklisted, migrated <span class="keyword">and</span> deleted formulae...</span></span><br></pre></td></tr></table></figure>
<h4 id="2）再brew安装mongodb-3-4"><a href="#2）再brew安装mongodb-3-4" class="headerlink" title="2）再brew安装mongodb 3.4"></a>2）再brew安装mongodb 3.4</h4><p><code>brew install mongodb@3.4</code></p>
<h2 id="三、启动异常"><a href="#三、启动异常" class="headerlink" title="三、启动异常"></a>三、启动异常</h2><h3 id="1-错误描述-1"><a href="#1-错误描述-1" class="headerlink" title="1. 错误描述"></a>1. 错误描述</h3><p>　　安装完成mongodb3.4之后，mongo服务启动异常。</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ mongo</span><br><span class="line">MongoDB shell version v3.<span class="number">4.10</span></span><br><span class="line">connecting <span class="keyword">to</span>: mongodb://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">27017</span></span><br><span class="line"><span class="number">2017</span>-<span class="number">12</span>-<span class="number">27</span>T11:<span class="number">13</span>:<span class="number">37.713</span>+<span class="number">0800</span> W NETWORK  [thread1] Failed <span class="keyword">to</span> connect <span class="keyword">to</span> <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">27017</span>, <span class="keyword">in</span>(checking socket <span class="keyword">for</span> <span class="literal">error</span> <span class="keyword">after</span> poll), reason: Connection refused</span><br><span class="line"><span class="number">2017</span>-<span class="number">12</span>-<span class="number">27</span>T11:<span class="number">13</span>:<span class="number">37.715</span>+<span class="number">0800</span> E QUERY    [thread1] <span class="literal">Error</span>: couldn<span class="symbol">'t</span> connect <span class="keyword">to</span> server <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">27017</span>, connection attempt failed :</span><br><span class="line">connect@src/mongo/shell/mongo.js:<span class="number">237</span>:<span class="number">13</span></span><br><span class="line">@(connect):<span class="number">1</span>:<span class="number">6</span></span><br><span class="line">exception: connect failed</span><br></pre></td></tr></table></figure>
<h3 id="2-错误原因-1"><a href="#2-错误原因-1" class="headerlink" title="2. 错误原因"></a>2. 错误原因</h3><p>　　mongodb的服务没有启动。</p>
<h3 id="3-解决办法-1"><a href="#3-解决办法-1" class="headerlink" title="3. 解决办法"></a>3. 解决办法</h3><h4 id="探索过程："><a href="#探索过程：" class="headerlink" title="探索过程："></a>探索过程：</h4><h5 id="1）用brew-services启动mongo不work"><a href="#1）用brew-services启动mongo不work" class="headerlink" title="1）用brew services启动mongo不work"></a>1）用brew services启动mongo不work</h5><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ brew services start mongodb@3.4</span><br><span class="line">==&gt; Successfully started `mongodb@3.4` (label: homebrew.mxcl.mongodb@3.4)</span><br><span class="line">$ brew services list</span><br><span class="line">Name        Status <span class="built_in"> User </span>   Plist</span><br><span class="line">mongodb@3.4 started yuzhang /Users/yuzhang/Library/LaunchAgents/homebrew.mxcl.mongodb@3.4.plist</span><br></pre></td></tr></table></figure>
<p>　　上述操作之后，似乎mongo已经启动了，但是问题依旧复现，可能是brew services不再有人维护的原因（<a href="https://github.com/Homebrew/legacy-homebrew/issues/32006" target="_blank" rel="noopener">brew services is unsupported and will be removed soon</a>）。</p>
<h5 id="2）用mongod启动mongo报错"><a href="#2）用mongod启动mongo报错" class="headerlink" title="2）用mongod启动mongo报错"></a>2）用mongod启动mongo报错</h5><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ mongod</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:11:28.980<span class="string">+0800</span> I CONTROL  [initandlisten] MongoDB starting : pid=8655 port=27017 dbpath=/data/db 64-bit host=CNyuzhang<span class="string">-2</span>.local</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:11:28.981<span class="string">+0800</span> I CONTROL  [initandlisten] db version v3.4.10</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:11:28.981<span class="string">+0800</span> I CONTROL  [initandlisten] git version: 078f28920cb24de0dd479b5ea6c66c644f6326e9</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:11:28.981<span class="string">+0800</span> I CONTROL  [initandlisten] OpenSSL version: OpenSSL 1.0.2n  7 Dec 2017</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:11:28.981<span class="string">+0800</span> I CONTROL  [initandlisten] allocator: system</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:11:28.981<span class="string">+0800</span> I CONTROL  [initandlisten] modules: none</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:11:28.981<span class="string">+0800</span> I CONTROL  [initandlisten] build environment:</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:11:28.981<span class="string">+0800</span> I CONTROL  [initandlisten]     distarch: x86_64</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:11:28.981<span class="string">+0800</span> I CONTROL  [initandlisten]     target_arch: x86_64</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:11:28.981<span class="string">+0800</span> I CONTROL  [initandlisten] options: &#123;&#125;</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:11:28.981<span class="string">+0800</span> I STORAGE  [initandlisten] exception in initAndListen: 29 Data directory /data/db not found., terminating</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:11:28.981<span class="string">+0800</span> I NETWORK  [initandlisten] shutdown: going to close listening sockets...</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:11:28.981<span class="string">+0800</span> I NETWORK  [initandlisten] shutdown: going to flush diaglog...</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:11:28.981<span class="string">+0800</span> I CONTROL  [initandlisten] now exiting</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:11:28.981<span class="string">+0800</span> I CONTROL  [initandlisten] shutting down with code:100</span><br></pre></td></tr></table></figure>
<p>　　上述错误信息里，明确指出<code>/data/db not found</code>，因此是在启动的时候没有找到db的地址。为了确认是这个问题，尝试使用如下指令：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mongo -nodb</span></span><br></pre></td></tr></table></figure>
<p>　　然后，发现可以直接进入mongo了。</p>
<h5 id="3）创建-data-db"><a href="#3）创建-data-db" class="headerlink" title="3）创建/data/db"></a>3）创建/data/db</h5><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$mkdir</span> -<span class="selector-tag">p</span> /data/db</span><br></pre></td></tr></table></figure>
<p>　　再次启动mongodb:</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:02.679<span class="string">+0800</span> I CONTROL  [initandlisten] MongoDB starting : pid=8510 port=27017 dbpath=/data/db 64-bit host=CNyuzhang<span class="string">-2</span>.local</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:02.680<span class="string">+0800</span> I CONTROL  [initandlisten] db version v3.4.10</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:02.680<span class="string">+0800</span> I CONTROL  [initandlisten] git version: 078f28920cb24de0dd479b5ea6c66c644f6326e9</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:02.680<span class="string">+0800</span> I CONTROL  [initandlisten] OpenSSL version: OpenSSL 1.0.2n  7 Dec 2017</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:02.680<span class="string">+0800</span> I CONTROL  [initandlisten] allocator: system</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:02.680<span class="string">+0800</span> I CONTROL  [initandlisten] modules: none</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:02.680<span class="string">+0800</span> I CONTROL  [initandlisten] build environment:</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:02.680<span class="string">+0800</span> I CONTROL  [initandlisten]     distarch: x86_64</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:02.680<span class="string">+0800</span> I CONTROL  [initandlisten]     target_arch: x86_64</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:02.680<span class="string">+0800</span> I CONTROL  [initandlisten] options: &#123;&#125;</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:02.681<span class="string">+0800</span> I STORAGE  [initandlisten] exception in initAndListen: 20 Attempted to create a lock file on a read-only directory: /data/db, terminating</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:02.681<span class="string">+0800</span> I NETWORK  [initandlisten] shutdown: going to close listening sockets...</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:02.681<span class="string">+0800</span> I NETWORK  [initandlisten] shutdown: going to flush diaglog...</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:02.681<span class="string">+0800</span> I CONTROL  [initandlisten] now exiting</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:02.681<span class="string">+0800</span> I CONTROL  [initandlisten] shutting down with code:100</span><br></pre></td></tr></table></figure>
<p>　　可以看出是对<code>/data/db</code>没有权限。</p>
<h5 id="4）用sudo执行mongod"><a href="#4）用sudo执行mongod" class="headerlink" title="4）用sudo执行mongod"></a>4）用sudo执行mongod</h5><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mongod</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.167<span class="string">+0800</span> I CONTROL  [initandlisten] MongoDB starting : pid=8521 port=27017 dbpath=/data/db 64-bit host=CNyuzhang<span class="string">-2</span>.local</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.167<span class="string">+0800</span> I CONTROL  [initandlisten] db version v3.4.10</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.167<span class="string">+0800</span> I CONTROL  [initandlisten] git version: 078f28920cb24de0dd479b5ea6c66c644f6326e9</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.167<span class="string">+0800</span> I CONTROL  [initandlisten] OpenSSL version: OpenSSL 1.0.2n  7 Dec 2017</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.167<span class="string">+0800</span> I CONTROL  [initandlisten] allocator: system</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.167<span class="string">+0800</span> I CONTROL  [initandlisten] modules: none</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.167<span class="string">+0800</span> I CONTROL  [initandlisten] build environment:</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.167<span class="string">+0800</span> I CONTROL  [initandlisten]     distarch: x86_64</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.167<span class="string">+0800</span> I CONTROL  [initandlisten]     target_arch: x86_64</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.167<span class="string">+0800</span> I CONTROL  [initandlisten] options: &#123;&#125;</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.170<span class="string">+0800</span> I -        [initandlisten] Detected data files in /data/db created by the 'wiredTiger' storage engine, so setting the active storage engine to 'wiredTiger'.</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.170<span class="string">+0800</span> I STORAGE  [initandlisten] wiredtiger_open config: create,cache_size=7680M,session_max=20000,eviction=(threads_min=4,threads_max=4),config_base=false,statistics=(fast),log=(enabled=true,archive=true,path=journal,compressor=snappy),file_manager=(close_idle_time=100000),checkpoint=(wait=60,log_size=2GB),statistics_log=(wait=0),</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.781<span class="string">+0800</span> I CONTROL  [initandlisten]</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.781<span class="string">+0800</span> I CONTROL  [initandlisten] ** WARNING: Access control is not enabled for the database.</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.781<span class="string">+0800</span> I CONTROL  [initandlisten] **          Read and write access to data and configuration is unrestricted.</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.781<span class="string">+0800</span> I CONTROL  [initandlisten] ** WARNING: You are running this process as the root user, which is not recommended.</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.781<span class="string">+0800</span> I CONTROL  [initandlisten]</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.822<span class="string">+0800</span> I FTDC     [initandlisten] Initializing full-time diagnostic data capture with directory '/data/db/diagnostic.data'</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:08.823<span class="string">+0800</span> I NETWORK  [thread1] waiting for connections on port 27017</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:11.182<span class="string">+0800</span> I NETWORK  [thread1] connection accepted from 127.0.0.1:52959 #1 (1 connection now open)</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:11.182<span class="string">+0800</span> I NETWORK  [thread1] connection accepted from 127.0.0.1:52960 #2 (2 connections now open)</span><br><span class="line">2017<span class="string">-12</span><span class="string">-27</span>T11:10:11.182<span class="string">+0800</span> I NETWORK  [thread1] connection accepted from 127.0.0.1:52961 #3 (3 connections now open)</span><br></pre></td></tr></table></figure>
<h4 id="解决方法小结"><a href="#解决方法小结" class="headerlink" title="解决方法小结"></a>解决方法小结</h4><ol>
<li>创建<code>/data/db</code>，因为mongodb默认的db地址是<code>/data/db</code></li>
<li>用sudo执行mongod</li>
</ol>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">mkdir</span> -p /<span class="class"><span class="keyword">data</span>/db</span></span><br><span class="line"><span class="title">sudo</span> mongod</span><br></pre></td></tr></table></figure>
<h2 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h2><ol>
<li>问题1是新版本3.6的mongodb做了一些改动造成的不兼容</li>
<li>问题2是brew services不再维护造成的启动异常</li>
</ol>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="https://stackoverflow.com/questions/29630399/mongo-connection-refused-osx" target="_blank" rel="noopener">Stackoverflow - Mongo connection refused osx</a></li>
<li><a href="https://stackoverflow.com/questions/23439343/cannot-connect-to-mongodb-errno61" target="_blank" rel="noopener">Stackoverflow - Cannot connect to MongoDB errno:61</a></li>
<li><a href="http://hcysun.me/2015/11/21/Mac下使用brew安装mongodb/" target="_blank" rel="noopener">Mac下使用brew安装mongodb</a></li>
</ul>

      
    </div>
    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/imgs/qr-code.png" alt="Zhang Yu wechat" style="width: 200px; max-width: 100%;"/>
    <div>扫一扫，用手机访问本站</div>
</div>

      </div>
    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Mongo/" rel="tag"># Mongo</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/12/26/MYSQL-索引概述/" rel="next" title="MYSQL - 索引概述">
                <i class="fa fa-chevron-left"></i> MYSQL - 索引概述
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/01/06/Nexus-SonatypeNexus入门/" rel="prev" title="Nexus - Sonatype Nexus入门">
                Nexus - Sonatype Nexus入门 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Zhang Yu</p>
              <p class="site-description motion-element" itemprop="description">行是知之始，知是行之成</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">69</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、背景"><span class="nav-number">1.</span> <span class="nav-text">一、背景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、安装异常"><span class="nav-number">2.</span> <span class="nav-text">二、安装异常</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-错误描述"><span class="nav-number">2.1.</span> <span class="nav-text">1. 错误描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-错误原因"><span class="nav-number">2.2.</span> <span class="nav-text">2. 错误原因</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-解决办法"><span class="nav-number">2.3.</span> <span class="nav-text">3. 解决办法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1）先用brew-search查看支持的mongo版本"><span class="nav-number">2.3.1.</span> <span class="nav-text">1）先用brew search查看支持的mongo版本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2）再brew安装mongodb-3-4"><span class="nav-number">2.3.2.</span> <span class="nav-text">2）再brew安装mongodb 3.4</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、启动异常"><span class="nav-number">3.</span> <span class="nav-text">三、启动异常</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-错误描述-1"><span class="nav-number">3.1.</span> <span class="nav-text">1. 错误描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-错误原因-1"><span class="nav-number">3.2.</span> <span class="nav-text">2. 错误原因</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-解决办法-1"><span class="nav-number">3.3.</span> <span class="nav-text">3. 解决办法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#探索过程："><span class="nav-number">3.3.1.</span> <span class="nav-text">探索过程：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1）用brew-services启动mongo不work"><span class="nav-number">3.3.1.1.</span> <span class="nav-text">1）用brew services启动mongo不work</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2）用mongod启动mongo报错"><span class="nav-number">3.3.1.2.</span> <span class="nav-text">2）用mongod启动mongo报错</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3）创建-data-db"><span class="nav-number">3.3.1.3.</span> <span class="nav-text">3）创建/data/db</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4）用sudo执行mongod"><span class="nav-number">3.3.1.4.</span> <span class="nav-text">4）用sudo执行mongod</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#解决方法小结"><span class="nav-number">3.3.2.</span> <span class="nav-text">解决方法小结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、总结"><span class="nav-number">4.</span> <span class="nav-text">四、总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#References"><span class="nav-number">5.</span> <span class="nav-text">References</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhang Yu</span>
  
   <span style="margin-left:8px;">
   <script src="http://s6.cnzz.com/stat.php?id=1263347220&web_id=1263347220" type="text/javascript"></script>
   </span>


  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.3</div>




        







  <div style="display: none;">
    <script src="//s95.cnzz.com/z_stat.php?id=1263347220&web_id=1263347220" language="JavaScript"></script>
  </div>



        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>


  

  <div style="display: none;">
    <script src="https://s19.cnzz.com/z_stat.php?id=1263347220&web_id=1263347220" language="JavaScript"></script>
  </div>




  


  




	





  





  












  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  


</body>
</html>
